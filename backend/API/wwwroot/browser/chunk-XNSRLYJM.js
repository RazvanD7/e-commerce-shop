import{a as M}from"./chunk-P6UBITM5.js";import{a as Be,b as Re}from"./chunk-NFY4UP5X.js";import{a as y}from"./chunk-USJXSOQJ.js";import{a as je}from"./chunk-6ZAJ5SDL.js";import{a as Y}from"./chunk-36MMH64F.js";import{Aa as Se,Ab as x,Ba as Ie,Bb as N,Ca as Fe,D as b,E as g,Eb as Te,F as ue,Ga as L,Ha as q,L as fe,Ma as Q,Na as I,Oa as _e,Pa as Ee,Q as a,Sa as xe,Ta as U,U as l,Ua as Ne,Ub as z,V as d,Vb as De,W as V,Wb as ce,Xb as W,Yb as O,Z as ve,Zb as Ve,_ as u,_a as Oe,ba as c,d as T,da as he,fa as n,ga as o,ha as s,ia as ke,ja as Ce,jb as $,k as pe,ka as ye,kb as H,la as S,mb as ae,na as f,oa as v,pb as Me,qb as we,ra as B,rb as h,sa as be,sb as F,tb as _,ua as R,va as j,w as le,wa as A,x as D,xa as ge,ya as p,yb as Pe,z as de,za as G,zb as E}from"./chunk-UDTUQTR4.js";function Ue(i,e){if(i&1){let t=S();n(0,"li",4)(1,"div",5)(2,"button",6),f("click",function(){let m=b(t).index,C=v();return g(C.onClick(m))}),p(3),o()()()}if(i&2){let t=e.$implicit,r=e.index,m=v();a(2),he("active",m.selectedIndex===r),c("disabled",!0),a(),Se(" ",t.label," ")}}function $e(i,e){if(i&1&&(n(0,"div"),ye(1,7),o()),i&2){let t=v();a(),c("ngTemplateOutlet",t.selected.content)}}var Z=class i extends ce{linearModeSelected;ngOnInit(){this.linear=this.linearModeSelected}onClick(e){this.selectedIndex=e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=ue(i)))(r||i)}})();static \u0275cmp=d({type:i,selectors:[["app-stepper"]],inputs:{linearModeSelected:"linearModeSelected"},standalone:!1,features:[Fe([{provide:ce,useExisting:i}]),ve],decls:4,vars:2,consts:[[1,"container"],[1,"nav","nav-pills","nav-justified"],["class","nav-item",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"nav-item"],[1,"d-grid"],[1,"nav-link","py-3","text-uppercase","fw-bold",3,"click","disabled"],[3,"ngTemplateOutlet"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"ul",1),u(2,Ue,4,4,"li",2),o(),u(3,$e,2,1,"div",3),o()),t&2&&(a(2),c("ngForOf",r.steps),a(),c("ngIf",r.selected))},dependencies:[Q,I,_e],styles:["button.nav-link[_ngcontent-%COMP%]{background:#e9ecef;border-radius:0;border:none;margin:0!important}button.nav-link[_ngcontent-%COMP%]:focus{outline:none}button.nav-link.active[_ngcontent-%COMP%]:hover{color:#fff}button.nav-link[_ngcontent-%COMP%]:active{outline:none}button.nav-link.active[_ngcontent-%COMP%]:focus{outline:none}button.nav-link[_ngcontent-%COMP%]:disabled:not(.active){color:#333}button.nav-link[_ngcontent-%COMP%]:not(.active){background:#e9ecef}.nav-item[_ngcontent-%COMP%]{padding:0!important}.d-grid[_ngcontent-%COMP%]{margin:0!important;padding:0!important}ul.nav-justified[_ngcontent-%COMP%]   li.nav-item[_ngcontent-%COMP%]{margin-left:0!important;margin-right:0!important;padding-left:0!important;padding-right:0!important}"]})};var X=class i{constructor(e,t){this.accountService=e;this.toastr=t}checkoutForm;saveUserAddress(){this.accountService.updateUserAddress(this.checkoutForm?.get("addressForm")?.value).subscribe(e=>{this.toastr.success("Address saved"),this.checkoutForm?.get("addressForm")?.reset(e)},e=>{console.log(e)})}static \u0275fac=function(t){return new(t||i)(l(Y),l(M))};static \u0275cmp=d({type:i,selectors:[["app-checkout-address"]],inputs:{checkoutForm:"checkoutForm"},standalone:!1,decls:26,vars:9,consts:[[1,"mt-4",3,"formGroup"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","mb-3","btn-outline-primary","save-address-button",3,"click","disabled"],["formGroupName","addressForm",1,"row"],[1,"form-group","col-6"],["formControlName","firstName",3,"label"],["formControlName","lastName",3,"label"],["formControlName","street",3,"label"],["formControlName","city",3,"label"],["formControlName","state",3,"label"],["formControlName","zipcode",3,"label"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["routerLink","/basket",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],["cdkStepperNext","",1,"btn","btn-primary",3,"disabled"],[1,"fa","fa-angle-right"]],template:function(t,r){if(t&1&&(n(0,"div",0)(1,"div",1)(2,"h4"),p(3,"Shipping address"),o(),n(4,"button",2),f("click",function(){return r.saveUserAddress()}),p(5," Save as default address "),o()(),n(6,"div",3)(7,"div",4),s(8,"app-text-input",5),o(),n(9,"div",4),s(10,"app-text-input",6),o(),n(11,"div",4),s(12,"app-text-input",7),o(),n(13,"div",4),s(14,"app-text-input",8),o(),n(15,"div",4),s(16,"app-text-input",9),o(),n(17,"div",4),s(18,"app-text-input",10),o()()(),n(19,"div",11)(20,"button",12),s(21,"i",13),p(22," Back to basket "),o(),n(23,"button",14),p(24," Go to Delivery "),s(25,"i",15),o()()),t&2){let m;c("formGroup",r.checkoutForm),a(4),c("disabled",!((m=r.checkoutForm.get("addressForm"))!=null&&m.valid)||!((m=r.checkoutForm.get("addressForm"))!=null&&m.dirty)),a(4),c("label","First name"),a(2),c("label","Last name"),a(2),c("label","Street"),a(2),c("label","City"),a(2),c("label","State"),a(2),c("label","Zip code"),a(5),c("disabled",r.checkoutForm.get("addressForm").invalid)}},dependencies:[H,F,_,E,N,x,z,W],styles:[".save-address-button[_ngcontent-%COMP%]{color:#921611;border-color:#921611}.save-address-button[_ngcontent-%COMP%]:hover{background-color:#921611;color:#fff}"]})};var P=class i{constructor(e){this.http=e}baseUrl=Me.apiUrl;getDeliveryMethods(){return this.http.get(this.baseUrl+"orders/deliveryMethods").pipe(pe(e=>e.sort((t,r)=>r.price-t.price)))}createOrder(e){return this.http.post(this.baseUrl+"orders",e)}static \u0275fac=function(t){return new(t||i)(de(Oe))};static \u0275prov=le({token:i,factory:i.\u0275fac,providedIn:"root"})};function Ze(i,e){if(i&1){let t=S();n(0,"div",9)(1,"input",10),f("click",function(){let m=b(t).$implicit,C=v();return g(C.setShippingPrice(m))}),o(),n(2,"label",11)(3,"strong"),p(4),L(5,"currency"),o(),s(6,"br"),n(7,"span",12),p(8),o()()()}if(i&2){let t=e.$implicit;a(),B("id",t.id),B("value",t.id),a(),B("for",t.id),a(2),Ie("",t.shortName," \u2013 ",q(5,6,t.price),""),a(4),G(t.description)}}var ee=class i{constructor(e,t){this.checkoutService=e;this.basketService=t}checkoutForm;deliveryMethods;ngOnInit(){this.checkoutService.getDeliveryMethods().subscribe(e=>{this.deliveryMethods=e},e=>{console.log(e)})}setShippingPrice(e){this.basketService.setShippingPrice(e)}static \u0275fac=function(t){return new(t||i)(l(P),l(y))};static \u0275cmp=d({type:i,selectors:[["app-checkout-delivery"]],inputs:{checkoutForm:"checkoutForm"},standalone:!1,decls:12,vars:3,consts:[[1,"mt-4",3,"formGroup"],[1,"mb-3"],["formGroupName","deliveryForm",1,"row","ml-5"],["class","col-6 form-group",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","flex-row","mb-5","mt-3"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],["cdkStepperNext","",1,"btn","btn-primary",3,"disabled"],[1,"fa","fa-angle-right"],[1,"col-6","form-group"],["type","radio","formControlName","deliveryMethod",1,"custom-control-input",3,"click","id","value"],[1,"custom-control-label",3,"for"],[1,"label-description"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"h4",1),p(2,"Choose your delivery method"),o(),n(3,"div",2),u(4,Ze,9,8,"div",3),o()(),n(5,"div",4)(6,"button",5),s(7,"i",6),p(8," Back to Address "),o(),n(9,"button",7),p(10," Go to Review "),s(11,"i",8),o()()),t&2&&(c("formGroup",r.checkoutForm),a(4),c("ngForOf",r.deliveryMethods),a(5),c("disabled",r.checkoutForm.get("deliveryForm").invalid))},dependencies:[Q,we,Pe,F,_,E,N,x,W,O,xe],encapsulation:2})};var te=class i{constructor(e,t){this.basketService=e;this.toastr=t}appStepper;basket$;ngOnInit(){this.basket$=this.basketService.basket$}createPaymentIntent(){return this.basketService.createPaymentIntent().subscribe(e=>{this.appStepper.next()},e=>{console.log(e),this.toastr.error(e.message)})}static \u0275fac=function(t){return new(t||i)(l(y),l(M))};static \u0275cmp=d({type:i,selectors:[["app-checkout-review"]],inputs:{appStepper:"appStepper"},standalone:!1,decls:10,vars:4,consts:[[1,"mt-4"],[3,"isBasket"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fa","fa-angle-right"]],template:function(t,r){if(t&1&&(n(0,"div",0),s(1,"app-basket-summary",1),o(),n(2,"div",2)(3,"button",3),s(4,"i",4),p(5," Back to Delivery "),o(),n(6,"button",5),L(7,"async"),f("click",function(){return r.createPaymentIntent()}),p(8," Go to Payment "),s(9,"i",6),o()()),t&2){let m;a(),c("isBasket",!1),a(5),c("disabled",((m=q(7,2,r.basket$))==null||m.items==null?null:m.items.length)===0)}},dependencies:[O,Re,Ee],encapsulation:2})};var Ke=["cardNumber"],et=["cardExpiry"],tt=["cardCvc"];function rt(i,e){if(i&1&&(ke(0),n(1,"span",17),p(2),o(),Ce()),i&2){let t=v();a(2),G(t.cardErrors)}}function it(i,e){i&1&&s(0,"i",18)}var re=class i{constructor(e,t,r,m,C){this.basketService=e;this.checkoutService=t;this.toastr=r;this.router=m;this.platformId=C}checkoutForm;cardNumberElement;cardExpiryElement;cardCvcElement;stripe;cardNumber;cardExpiry;cardCvc;cardErrors;cardHandler=this.onChange.bind(this);loading=!1;cardNumberValid=!1;cardExpiryValid=!1;cardCvcValid=!1;ngAfterViewInit(){this.stripe=Stripe("pk_test_51RTM2dQcjXsF1HJgNsRPyCHpgUzbmKsgEsaWeZ5UVMoJts1eaC0FETFajScIkxIeR6nXGYQEEmruer8miVRZi3VT00qYoj3w11");let e=this.stripe.elements();this.cardNumber=e.create("cardNumber"),this.cardNumber.mount(this.cardNumberElement.nativeElement),this.cardNumber.addEventListener("change",this.cardHandler),this.cardExpiry=e.create("cardExpiry"),this.cardExpiry.mount(this.cardExpiryElement.nativeElement),this.cardExpiry.addEventListener("change",this.cardHandler),this.cardCvc=e.create("cardCvc"),this.cardCvc.mount(this.cardCvcElement.nativeElement),this.cardCvc.addEventListener("change",this.cardHandler)}ngOnDestroy(){Ne(this.platformId)&&(this.cardNumber.destroy(),this.cardExpiry.destroy(),this.cardCvc.destroy())}onChange(e){switch(e.error?this.cardErrors=e.error.message:this.cardErrors=null,e.elementType){case"cardNumber":this.cardNumberValid=e.complete;break;case"cardExpiry":this.cardExpiryValid=e.complete;break;case"cardCvc":this.cardCvcValid=e.complete;break}}submitOrder(){return T(this,null,function*(){this.loading=!0;let e=this.basketService.getCurrentBasketValue();try{let t=yield this.createOrder(e),r=yield this.confirmPaymentWithStripe(e);if(r.paymentIntent){this.basketService.deleteBasket(e);let m={state:t};this.router.navigate(["checkout/success"],m)}else this.toastr.error(r.error.message);this.loading=!1}catch(t){console.log(t),this.loading=!1}})}confirmPaymentWithStripe(e){return T(this,null,function*(){return this.stripe.confirmCardPayment(e.clientSecret,{payment_method:{card:this.cardNumber,billing_details:{name:this.checkoutForm?.get("paymentForm")?.get("nameOnCard")?.value}}})})}createOrder(e){return T(this,null,function*(){let t=this.getOrderToCreate(e);return this.checkoutService.createOrder(t).toPromise()})}getOrderToCreate(e){return{basketId:e.id,deliveryMethodId:+this.checkoutForm?.get("deliveryForm")?.get("deliveryMethod")?.value,shipToAddress:this.checkoutForm?.get("addressForm")?.value}}static \u0275fac=function(t){return new(t||i)(l(y),l(P),l(M),l($),l(fe))};static \u0275cmp=d({type:i,selectors:[["app-checkout-payment"]],viewQuery:function(t,r){if(t&1&&(R(Ke,7),R(et,7),R(tt,7)),t&2){let m;j(m=A())&&(r.cardNumberElement=m.first),j(m=A())&&(r.cardExpiryElement=m.first),j(m=A())&&(r.cardCvcElement=m.first)}},inputs:{checkoutForm:"checkoutForm"},standalone:!1,decls:22,vars:5,consts:[["cardNumber",""],["cardExpiry",""],["cardCvc",""],[1,"mt-4",3,"formGroup"],[1,"row"],["formGroupName","paymentForm",1,"form-group","col-12"],["formControlName","nameOnCard",3,"label"],[1,"form-group","col-6"],[1,"form-control","py-3"],[4,"ngIf"],[1,"form-group","col-3"],[1,"d-flex","justify-content-between","flex-row","mb-5","mt-3"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fa","fa-angle-right"],["class","fa fa-spinner fa-spin",4,"ngIf"],[1,"text-danger"],[1,"fa","fa-spinner","fa-spin"]],template:function(t,r){if(t&1){let m=S();n(0,"div",3)(1,"div",4)(2,"div",5),s(3,"app-text-input",6),o(),n(4,"div",7),s(5,"div",8,0),u(7,rt,3,1,"ng-container",9),o(),n(8,"div",10),s(9,"div",8,1),o(),n(11,"div",10),s(12,"div",8,2),o()()(),n(14,"div",11)(15,"button",12),s(16,"i",13),p(17," Back to Review "),o(),n(18,"button",14),f("click",function(){return b(m),g(r.submitOrder())}),p(19," Submit Order "),s(20,"i",15),u(21,it,1,0,"i",16),o()()}t&2&&(c("formGroup",r.checkoutForm),a(3),c("label","Name on card"),a(4),c("ngIf",r.cardErrors),a(11),c("disabled",r.loading||r.checkoutForm.get("paymentForm").invalid||!r.cardNumberValid||!r.cardExpiryValid||!r.cardCvcValid),a(3),c("ngIf",r.loading))},dependencies:[I,F,_,E,N,x,z,O],encapsulation:2})};var ie=class i{constructor(e,t,r){this.fb=e;this.accountService=t;this.basketService=r}checkoutForm;basketTotals$;ngOnInit(){this.createCheckoutForm(),this.getAddressFormValues(),this.getDeliveryMethodValue(),this.basketTotals$=this.basketService.basketTotal$}createCheckoutForm(){this.checkoutForm=this.fb.group({addressForm:this.fb.group({firstName:[null,h.required],lastName:[null,h.required],street:[null,h.required],city:[null,h.required],state:[null,h.required],zipcode:[null,h.required]}),deliveryForm:this.fb.group({deliveryMethod:[null,h.required]}),paymentForm:this.fb.group({nameOnCard:[null,h.required]})})}getAddressFormValues(){this.accountService.getUserAddress().subscribe(e=>{e&&this.checkoutForm.get("addressForm")?.patchValue(e)},e=>{console.log(e)})}getDeliveryMethodValue(){let e=this.basketService.getCurrentBasketValue();e.deliveryMethodId!==null&&this.checkoutForm.get("deliveryForm")?.get("deliveryMethod")?.patchValue(e.deliveryMethodId?.toString())}static \u0275fac=function(t){return new(t||i)(l(Te),l(Y),l(y))};static \u0275cmp=d({type:i,selectors:[["app-checkout"]],standalone:!1,decls:15,vars:11,consts:[["appStepper",""],[1,"container","mt-5"],[1,"row"],[1,"col-8"],[3,"linearModeSelected"],[3,"label","completed"],[3,"checkoutForm"],[3,"label"],[3,"appStepper"],[1,"col-4"]],template:function(t,r){if(t&1&&(n(0,"div",1)(1,"div",2)(2,"div",3)(3,"app-stepper",4,0)(5,"cdk-step",5),s(6,"app-checkout-address",6),o(),n(7,"cdk-step",5),s(8,"app-checkout-delivery",6),o(),n(9,"cdk-step",7),s(10,"app-checkout-review",8),o(),n(11,"cdk-step",7),s(12,"app-checkout-payment",6),o()()(),n(13,"div",9),s(14,"app-order-totals"),o()()()),t&2){let m,C,Qe=ge(4);a(3),c("linearModeSelected",!0),a(2),c("label","Address")("completed",r.checkoutForm==null||(m=r.checkoutForm.get("addressForm"))==null?null:m.valid),a(),c("checkoutForm",r.checkoutForm),a(),c("label","Delivery")("completed",r.checkoutForm==null||(C=r.checkoutForm.get("deliveryForm"))==null?null:C.valid),a(),c("checkoutForm",r.checkoutForm),a(),c("label","Review"),a(),c("appStepper",Qe),a(),c("label","Payment"),a(),c("checkoutForm",r.checkoutForm)}},dependencies:[Be,Z,De,X,ee,te,re],encapsulation:2})};function nt(i,e){if(i&1&&(n(0,"button",5),p(1,"View your order"),o()),i&2){let t=v();be("routerLink","/orders/",t.order==null?null:t.order.id,"")}}function at(i,e){i&1&&(n(0,"button",6),p(1,"View your orders"),o())}var oe=class i{constructor(e){this.router=e;let t=this.router.getCurrentNavigation(),r=t&&t.extras&&t.extras.state;r&&(this.order=r)}order;ngOnInit(){}static \u0275fac=function(t){return new(t||i)(l($))};static \u0275cmp=d({type:i,selectors:[["app-checkout-success"]],standalone:!1,decls:9,vars:2,consts:[[1,"container","mt-5"],[1,"fa","fa-check-circle","fa-5x",2,"color","green"],[1,"mb-4"],["class","btn btn-outline-success",3,"routerLink",4,"ngIf"],["routerLink","/orders","class","btn btn-outline-success",4,"ngIf"],[1,"btn","btn-outline-success",3,"routerLink"],["routerLink","/orders",1,"btn","btn-outline-success"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div"),s(2,"i",1),o(),n(3,"h2"),p(4,"Thank you. Your order is confirmed"),o(),n(5,"p",2),p(6,"Your order will be delivered soon!"),o(),u(7,nt,2,2,"button",3)(8,at,2,0,"button",4),o()),t&2&&(a(7),c("ngIf",r.order),a(),c("ngIf",!r.order))},dependencies:[I,H],encapsulation:2})};var ct=[{path:"",component:ie},{path:"success",component:oe}],ne=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=V({type:i});static \u0275inj=D({imports:[U,ae.forChild(ct),ae]})};var qe=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=V({type:i});static \u0275inj=D({imports:[U,ne,Ve,je]})};export{qe as CheckoutModule};
